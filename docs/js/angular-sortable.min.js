/*
 jQuery UI Sortable plugin wrapper

 @param [ui-sortable] {object} Options to pass to $.fn.sortable() merged onto ui.config
 */
angular.module("ui.sortable",[]).value("uiSortableConfig",{items:"> [ng-repeat],> [data-ng-repeat],> [x-ng-repeat]"}).directive("uiSortable",["uiSortableConfig","$timeout","$log",function(e,t,o){return{require:"?ngModel",scope:{ngModel:"=",uiSortable:"=",create:"&uiSortableCreate",start:"&uiSortableStart",activate:"&uiSortableActivate",beforeStop:"&uiSortableBeforeStop",update:"&uiSortableUpdate",remove:"&uiSortableRemove",receive:"&uiSortableReceive",deactivate:"&uiSortableDeactivate",stop:"&uiSortableStop"},link:function(n,r,i,a){function l(e,t){var o="function"==typeof e,n="function"==typeof t
return o&&n?function(){e.apply(this,arguments),t.apply(this,arguments)}:n?t:e}function u(e){var t=e.data("ui-sortable")
return t&&"object"==typeof t&&"ui-sortable"===t.widgetFullName?t:null}function s(t,o){return M[t]?("stop"===t&&(o=l(o,function(){n.$apply()}),o=l(o,g)),o=l(M[t],o)):U[t]&&(o=U[t](o)),o||"items"!==t&&"ui-model-items"!==t||(o=e.items),o}function c(e,t,o){function n(e,t){t in _||(_[t]=null)}angular.forEach(M,n)
var r=null
if(t){var i
angular.forEach(t,function(t,o){if(!(e&&o in e)){if(o in E)return void(_[o]="ui-floating"===o?"auto":s(o,void 0))
i||(i=angular.element.ui.sortable().options)
var n=i[o]
n=s(o,n),r||(r={}),r[o]=n,_[o]=n}})}return angular.forEach(e,function(e,t){if(t in E)return"ui-floating"!==t||!1!==e&&!0!==e||!o||(o.floating=e),void(_[t]=s(t,e))
e=s(t,e),r||(r={}),r[t]=e,_[t]=e}),r}function d(e){var t=e.sortable("option","placeholder")
if(t&&t.element&&"function"==typeof t.element){var o=t.element()
return o=angular.element(o)}return null}function f(e,t){var o=_["ui-model-items"].replace(/[^,]*>/g,"")
return e.find('[class="'+t.attr("class")+'"]:not('+o+")")}function m(e,t){var o=e.sortable("option","helper")
return"clone"===o||"function"==typeof o&&t.item.sortable.isCustomHelperUsed()}function b(e,t){var o=null
return m(e,t)&&"parent"===e.sortable("option","appendTo")&&(o=x),o}function p(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}function v(e,t){for(var o=0;o<e.length;o++){var n=e[o]
if(n.element[0]===t[0])return n}}function g(e,t){t.item.sortable._destroy()}function h(e){return e.parent().find(_["ui-model-items"]).index(e)}function S(){n.$watchCollection("ngModel",function(){t(function(){u(r)&&r.sortable("refresh")},0,!1)}),M.start=function(e,t){if("auto"===_["ui-floating"]){var o=t.item.siblings()
u(angular.element(e.target)).floating=p(o)}var n=h(t.item)
t.item.sortable={model:a.$modelValue[n],index:n,source:r,sourceList:t.item.parent(),sourceModel:a.$modelValue,cancel:function(){t.item.sortable._isCanceled=!0},isCanceled:function(){return t.item.sortable._isCanceled},isCustomHelperUsed:function(){return!!t.item.sortable._isCustomHelperUsed},_isCanceled:!1,_isCustomHelperUsed:t.item.sortable._isCustomHelperUsed,_destroy:function(){angular.forEach(t.item.sortable,function(e,o){t.item.sortable[o]=void 0})},_connectedSortables:[],_getElementContext:function(e){return v(this._connectedSortables,e)}}},M.activate=function(e,t){var o=t.item.sortable.source===r,i=o?t.item.sortable.sourceList:r,a={element:r,scope:n,isSourceContext:o,savedNodesOrigin:i}
t.item.sortable._connectedSortables.push(a),$=i.contents(),x=t.helper
var l=d(r)
if(l&&l.length){var u=f(r,l)
$=$.not(u)}},M.update=function(e,t){if(!t.item.sortable.received){t.item.sortable.dropindex=h(t.item)
var o=t.item.closest("[ui-sortable], [data-ui-sortable], [x-ui-sortable]")
t.item.sortable.droptarget=o,t.item.sortable.droptargetList=t.item.parent()
var i=t.item.sortable._getElementContext(o)
t.item.sortable.droptargetModel=i.scope.ngModel,r.sortable("cancel")}var l=!t.item.sortable.received&&b(r,t,$)
l&&l.length&&($=$.not(l))
var u=t.item.sortable._getElementContext(r)
$.appendTo(u.savedNodesOrigin),t.item.sortable.received&&($=null),t.item.sortable.received&&!t.item.sortable.isCanceled()&&(n.$apply(function(){a.$modelValue.splice(t.item.sortable.dropindex,0,t.item.sortable.moved)}),n.$emit("ui-sortable:moved",t))},M.stop=function(e,t){var o="dropindex"in t.item.sortable&&!t.item.sortable.isCanceled()
if(o&&!t.item.sortable.received)n.$apply(function(){a.$modelValue.splice(t.item.sortable.dropindex,0,a.$modelValue.splice(t.item.sortable.index,1)[0])}),n.$emit("ui-sortable:moved",t)
else if(!o&&!angular.equals(r.contents().toArray(),$.toArray())){var i=b(r,t,$)
i&&i.length&&($=$.not(i))
var l=t.item.sortable._getElementContext(r)
$.appendTo(l.savedNodesOrigin)}$=null,x=null},M.receive=function(e,t){t.item.sortable.received=!0},M.remove=function(e,t){"dropindex"in t.item.sortable||(r.sortable("cancel"),t.item.sortable.cancel()),t.item.sortable.isCanceled()||n.$apply(function(){t.item.sortable.moved=a.$modelValue.splice(t.item.sortable.index,1)[0]})},angular.forEach(M,function(e,t){M[t]=l(M[t],function(){var e,o=n[t]
"function"==typeof o&&("uiSortable"+t.substring(0,1).toUpperCase()+t.substring(1)).length&&"function"==typeof(e=o())&&e.apply(this,arguments)})}),U.helper=function(e){return e&&"function"==typeof e?function(t,o){var n=o.sortable,i=h(o)
o.sortable={model:a.$modelValue[i],index:i,source:r,sourceList:o.parent(),sourceModel:a.$modelValue,_restore:function(){angular.forEach(o.sortable,function(e,t){o.sortable[t]=void 0}),o.sortable=n}}
var l=e.apply(this,arguments)
return o.sortable._restore(),o.sortable._isCustomHelperUsed=o!==l,l}:e},n.$watchCollection("uiSortable",function(e,t){var o=u(r)
if(o){var n=c(e,t,o)
n&&r.sortable("option",n)}},!0),c(_)}function C(){a?S():o.info("ui.sortable: ngModel not provided!",r),r.sortable(_)}function y(){return(!n.uiSortable||!n.uiSortable.disabled)&&(C(),y.cancelWatcher(),y.cancelWatcher=angular.noop,!0)}var $,x,_={},E={"ui-floating":void 0,"ui-model-items":e.items},M={create:null,start:null,activate:null,beforeStop:null,update:null,remove:null,receive:null,deactivate:null,stop:null},U={helper:null}
if(angular.extend(_,E,e,n.uiSortable),!angular.element.fn||!angular.element.fn.jquery)return void o.error("ui.sortable: jQuery should be included before AngularJS!")
y.cancelWatcher=angular.noop,y()||(y.cancelWatcher=n.$watch("uiSortable.disabled",y))}}}])
